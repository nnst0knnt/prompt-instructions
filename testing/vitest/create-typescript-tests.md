# Vitest x TypeScript プロジェクトのテスト実装

## プロジェクト概要

複数のモジュールで構成される、ファイルシステム操作を含む TypeScript プロジェクトのテスト実装方針を定義します。

コアとなるビジネスロジック、ファイル操作など、異なる責務を持つモジュール群の品質を確保することが目的です。

## 実装方針

### 1. モック化

```typescript
// 例）
vi.mock("fs", () => ({
  default: {
    existsSync: vi.fn(),
    writeFileSync: vi.fn(),
  },
}));
```

外部依存（ファイルシステム、パス操作など）は必ずモック化する

### 2. テストケース

```typescript
// 例）
describe("ファイル名", () => {
  describe("メソッド名", () => {
    it("期待される動作の説明（日本語）", async () => {
      // テスト実装
    });
  });
});
```

### 3. エラーハンドリング例

```typescript
// 例）
await expect(method()).rejects.toThrow(
  new CustomError("期待されるエラーメッセージ")
);
```

### 4. テスト環境リセット

```typescript
// 例）
beforeEach(() => {
  vi.resetModules();
  vi.clearAllMocks();
});
```

## 規約

### 1. ファイル配置

- テストファイル：`{対象}.test.ts`
- 配置場所：テスト対象と同一ディレクトリ

### 2. テストケース

- テストの意図を明確に説明すること
- AAA を意識すること
- 日本語を利用すること
- `○○こと`や`××の場合○○こと`という表現に揃えること
- 正常系、境界値、異常系の順序で記述すること

### 3. グルーピング

- 機能単位で `describe` でグループ化すること
- 関連するテストケースをまとめること

## 注意点

- 1 つのテストで 1 つの振る舞いを検証する
- Arrange-Act-Assert（AAA パターン）を意識する
- テスト名は分かりやすく書く
- 不要なコードを省く
- 外部 API やデータベースを直接テストしない
- 状態管理を適切にモックする
- テストごとに状態をリセットする
- 不要な処理を避け、テスト実行速度を考慮する
- async/await を適切に使用する
- 非同期コードのテストは waitFor() を使う
- 依存関係のインポートミスに注意する
- TypeScript の型エラーを見逃さない
- カバレッジレポートを活用する
- 環境変数や日時に依存しないテストを書く
- CI/CD 環境での動作を確認する
- エラーハンドリングのテストを忘れない

この指示書に基づき、プロジェクトの特性を考慮しながら、効果的なテスト実装を進めてください。
